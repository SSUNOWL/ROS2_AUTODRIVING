inetic MPC(Dynamic Bicycle Model 기반 MPC)는 튜닝할 수 있는 파라미터가 꽤 많습니다. 이 파라미터들을 어떻게 설정하느냐에 따라 **"할머니처럼 조심스럽게 운전하는 차"**가 될 수도 있고, **"F1 레이서처럼 공격적으로 코너를 공략하는 차"**가 될 수도 있습니다.크게 4가지 카테고리로 나누어 설명해 드리겠습니다.1. 예측 구간 설정 (Prediction Horizon)MPC가 **"얼마나 멀리 내다볼 것인가"**를 결정합니다.$N$ (Horizon Step, 스텝 수)의미: 앞으로 몇 번의 예측을 수행할 것인가? (예: 20번)영향:너무 크면: 연산량이 늘어나서 **렉(Lag)**이 걸립니다. (Solver가 늦게 답을 줌 -> 사고 원인)너무 작으면: 코너가 다가오는데 속도를 줄이지 못하고 벽에 박습니다. (근시안적 운전)$dt$ (Time Step, 시간 간격)의미: 한 스텝당 몇 초 뒤를 예측할 것인가? (예: 0.1초)영향:너무 크면: 예측이 듬성듬성해져서 정밀한 제어가 불가능합니다.너무 작으면: $N$을 아주 크게 키워야 멀리 볼 수 있으므로 연산량이 폭증합니다.Look-ahead Distance ($N \times dt \times Speed$)보통 $N=20, dt=0.05 \sim 0.1$ 정도를 많이 씁니다. (약 1~2초 앞을 내다봄)2. 비용 함수 가중치 (Cost Function Weights) - 가장 중요!Solver에게 **"무엇이 더 중요한가?"**를 알려주는 값입니다. 운전 성향을 결정합니다.A. 상태 오차 가중치 행렬 ($Q$)차량이 경로(Reference)와 틀어졌을 때 얼마나 혼낼 것인가?$$J_{state} = Q_x (x_{err})^2 + Q_y (y_{err})^2 + Q_{\psi} (\psi_{err})^2 + \dots$$$Q_x, Q_y$ (위치 가중치)높으면: 기차처럼 레일 위를 벗어나지 않으려고 노력합니다.낮으면: 코너에서 **"In-course"**를 파고들거나, 경로를 살짝 이탈하더라도 부드럽게 가는 것을 허용합니다.$Q_{\psi}$ (헤딩/각도 가중치)높으면: 차의 머리 방향을 경로 방향과 똑같이 맞추려고 애씁니다.낮으면: 차가 옆으로 미끄러지면서 가는 것(Drift 각도)을 어느 정도 허용합니다. 너무 높으면 차가 뻣뻣하게 움직여서 코너를 못 돕니다. (보통 위치보다 낮게 줍니다. 예: 1.0 ~ 5.0)$Q_v$ (속도 가중치)높으면: 목표 속도를 칼같이 지킵니다.낮으면: 코너를 돌기 위해(또는 급조작을 막기 위해) 속도를 줄이는 것을 허용합니다.B. 제어 입력 가중치 행렬 ($R$)운전자가 핸들이나 페달을 쓸 때 얼마나 아껴 쓸 것인가?$R_{\delta}$ (조향 가중치)높으면: 핸들을 아주 천천히, 부드럽게 꺾습니다. (승차감 위주)낮으면: 핸들을 팍팍 꺾습니다. 너무 낮으면 차가 좌우로 떨리는(Oscillation) 현상이 발생합니다. (F1TENTH에서는 보통 높게 줍니다. 예: 2000 ~ 20000)$R_{acc}$ (가속도 가중치)높으면: 급출발/급제동을 안 합니다.낮으면: 풀악셀/풀브레이킹을 사용합니다. (레이싱에서는 낮게 줍니다. 예: 1 ~ 10)3. 제약 조건 (Constraints)물리적으로 불가능하거나 위험한 행동을 막는 안전장치입니다.입력 제약 (Input Constraints)max_steer: 차의 물리적 조향 한계 (예: 0.4189 rad = 24도). 이걸 넘어가면 Solver가 답을 못 찾거나 현실과 괴리가 생깁니다.max_acc: 모터의 최대 가속력.상태 제약 (State Constraints) (보통 F1TENTH 기본 코드엔 없지만 추가 가능)트랙 경계선(Track Boundary)을 넘지 말라는 제약을 걸 수 있습니다.4. 차량 물리 모델 파라미터 (Model Parameters)Dynamic Bicycle Model을 쓰시므로, 이 값들이 실제 차량과 다르면 예측이 빗나갑니다.$m$ (질량), $I_z$ (관성모멘트)차가 무거울수록 코너에서 밖으로 밀려나는 힘(원심력)을 더 크게 계산합니다.$L_f, L_r$ (축거)무게중심에서 앞/뒤 바퀴까지 거리. 회전 반경에 직접적인 영향을 줍니다.$C_f, C_r$ (코너링 강성, Cornering Stiffness) - 핵심!의미: 타이어가 얼마나 도로를 꽉 움켜쥐는가? (마찰력과 관련)영향:이 값을 너무 크게 잡으면: Solver는 "우리 차는 절대 안 미끄러져"라고 착각하고 과속으로 코너에 진입하다가 실제로는 미끄러져 벽에 박습니다.이 값을 너무 작게 잡으면: 빙판길이라고 생각해서 너무 기어갑니다.F1TENTH 차량 바퀴는 고무가 딱딱해서 생각보다 잘 미끄러지므로, 기본값보다 조금 낮춰 잡는 게 안전할 수 있습니다.🏁 튜닝 추천 순서 (Recipe)차가 이상하게 움직일 때 다음 순서로 건드려보세요.차가 좌우로 떤다 (Wobbling): -> $R_{\delta}$ (핸들 비용)을 높이세요.코너를 못 돌고 밖으로 튕겨 나간다 (Understeer): -> $Q_x, Q_y$ (위치 비용)을 높이거나, 예측 구간($N$)을 늘리세요.차가 너무 느리게 반응한다: -> $R_{\delta}, R_{acc}$ (입력 비용)을 낮추세요.예측 경로가 뱀처럼 휜다: -> $C_f, C_r$ (타이어 강성) 모델 파라미터가 맞는지 확인하거나, $R_{\delta}$를 높여서 진정시키세요.지금 선재님의 상황(주행은 되는데 최적화 필요)에서는 $Q$와 $R$ 행렬을 가지고 노는 게 가장 효과가 큽니다!