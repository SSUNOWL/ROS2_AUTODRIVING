tuning 완료
ros2 launch racecar_frenet_cpp frenet.launch.py
ros2 launch f1tenth_planner fgm.launch.py


<최단 시간 레이싱> 실험 1 -> 각각의 최단 시간 측정하기
의도: 
터미널 1 기본값 (지도: Spielberg_map, robot = 1)
ros2 launch f1tenth_gym_ros map_gym_bridge.py
터미널2 (static publisehr, frenet, fgm, mux, pp, collision, logger)
launch 파라미터 = frenet, pp 의 프로필 선택, (상대차가 있는경우 csv파일), pp가 어떤 경로만 받는지 (기본값 = /selected_path)
static publisher-> 상대차 csv파일을 읽고 시작위치를 정해줌


ros2 launch planner_mux time_trial_mux.launch.py


(기본값 mux)
ros2 launch planner_mux time_trial.launch.py  
(frenet only)
ros2 launch planner_mux time_trial.launch.py pp_path_topic:=/frenet_local_plan 
(fgm only)
ros2 launch planner_mux time_trial.launch.py pp_path_topic:=/fgm_path  

<테스트 시나리오 1> 180, 90도 코너링
의도: 급격한 회전에서 잘가는가?
터미널 1 (지도 map360)
ros2 launch f1tenth_gym_ros map_gym_bridge.py map_name:=hairpin_combo_map num_agent:=1 map_img_ext:=.pgm

ros2 launch planner_mux time_trial.launch.py \
  csv_path:=raceline_hairpin_combo.csv

ros2 launch planner_mux time_trial.launch.py \
  csv_path:=180wind.csv pp_path_topic:=/frenet_local_plan 
ros2 launch planner_mux time_trial.launch.py \
  csv_path:=180wind.csv pp_path_topic:=/fgm_path

ros2 run racecar_experiments path_timer


<테스트 시나리오 2> 마주오는 자동차 회피시나리오 -> 
ros2 launch f1tenth_gym_ros map_gym_bridge.py map_name:=playground num_agent:=2 map_img_ext:=.pgm

ros2 run racecar_experiments static_path_publisher   --ros-args -p csv_path:="$(pwd)/raceline_playground.csv" -p opponent_csv_path:="$(pwd)/bumper_v_2.csv" -p spawn_opponent_enabled:=true

ros2 run racecar_experiments opponent_pure_pursuit_node   --ros-args   -p csv_path:="$(pwd)/bumper_v_2.csv"   -p odom_topic:="/opp_racecar/odom"   -p drive_topic:="/opp_drive"   -p max_speed:=5.0
(v=2, 3, 4, 5)
bumper_v_2  (마주보는거 회피)
bumper_slow_1 (같은방향 추월)

ros2 launch f1tenth_planner fgm_with_pp.launch.py \ fgm_gap_threshold:=1.2 \ fgm_bubble_radius:=0.5 \ fgm_fov_angle:=180.0 \ fgm_speed_check_fov_deg:=25.0 \ fgm_required_clearance:=0.55 \ fgm_width_weight:=0.6 \ fgm_angle_weight:=6.0 \ fgm_steer_weight:=0.08 \ fgm_hysteresis_bonus:=2.0 \ fgm_change_threshold:=0.25 \ fgm_smoothing_alpha:=0.5 \ fgm_dynamic_bubble_speed_coeff:=0.12

ros2 launch racecar_experiments experiment_logger.launch.py     scenario_name:=bumper     planner_mode:=FGM     output_dir:=$(pwd)/logs     collision_topic:=/experiments/crash_detected

ㄴ 이걸로 파라미터 튜닝 ㄱㄱ
초반 몇개는 이걸로 값 몇개 추려보고 대충 범위 추리기
파라미터 로 팔만대장경 만들어서 자동화
이후 ./fgm_batch_run.sh
-> 자동화 만들어놨음 
한번 다 돌아가는지 실행해놨다가 fgm_batch_run.sh들어가서 
use_rviz 파라미터 false로 하면 백그라운드 자동화가능
ㄴ 수업시간에 조져놓고 튜닝하고 mux 떙기고 빠르게 튜닝 레츠고

<테스트 시나리오 3> 수동차 나란히 주행 (네모난걸 만들어서 주행)
ros2 launch f1tenth_gym_ros map_gym_bridge.py num_agent:=2

ros2 run racecar_experiments static_path_publisher   --ros-args -p csv_path:="$(pwd)/raceline_with_yaw.csv"

ros2 launch racecar_frenet_cpp frenet_with_pp_profile.launch.py

ros2 run racecar_experiments opponent_pure_pursuit_node   --ros-args   -p csv_path:="$(pwd)/spielberg_opponent_scenarioB.csv"   -p odom_topic:="/opp_racecar/odom"   -p drive_topic:="/opp_drive"   -p max_speed:=5.0

    sx1: -72.6722
    sy1: 48.7323
    stheta1: -0.713558
    (상대차 시작위치)



<파라미터에 따라 바꾸기>
ros2 launch f1tenth_gym_ros map_gym_bridge.py map_name:=test_scenarios num_agent:=2 map_img_ext:=.pgm






실행 전 - f1_sim_ws/src/f1tenth_gym_ros/config/sim.yaml 들어가서
map_path: "/home/<사용자이름>/f1_sim_ws/src/f1tenth_gym_ros/maps/Spielberg_map"
<사용자이름> 부분을 내 우분투 아이디로 변경

윈도우 환경에서 RIVZ2 회색화면만 보이는 경우
파일 실행 전
export LIBGL_ALWAYS_SOFTWARE=1


<터미널 1> - 시뮬레이터 (필수)
cd ~/f1_sim_ws
colcon build
source install/setup.bash
ros2 launch f1tenth_gym_ros gym_bridge_launch.py

<터미널 2> - 기존 Nav2 (사용 안할거임)
cd ~/f1_sim_ws
source install/setup.bash
ros2 launch src/racecar_control_py/launch/nav2_launch.py

<터미널 2> - dwa 알고리즘 (필수)
cd ~/f1_sim_ws
source install/setup.bash
ros2 launch racecar_dwa_cpp dwa_local_planner.launch.py

<터미널 3> - /cmd_vel -> /drive로 변경함 (nav2 이용시 사용) 
cd ~/f1_sim_ws
source install/setup.bash
ros2 run racecar_teleop_cpp teleop_converter

<터미널 4> - 상대 차 조종 (필수)
cd ~/f1_sim_ws
source install/setup.bash
ros2 run racecar_teleop_cpp opp_teleop

<터미널 5> - 경로 도착 시간
cd ~/f1_sim_ws
source install/setup.bash
ros2 run racecar_experiments path_timer

<터미널 6> - 충돌 감지
cd ~/f1_sim_ws
source install/setup.bash
ros2 run racecar_experiments collision_monitor

<터미널 7> - 전역 경로 저장
cd ~/f1_sim_ws
source install/setup.bash
ros2 run racecar_experiments path_saver

<터미널 8> - 전역 경로 발행 .csv 를 발행함
cd ~/f1_sim_ws
source install/setup.bash
ros2 run racecar_experiments static_path_publisher --ros-args -p csv_path:="$(pwd)/path_segment.csv" // 사용자 지정 경로

ros2 run racecar_experiments static_path_publisher --ros-args -p csv_path:="$(pwd)/raceline_with_speed.csv" // 트랙 전용

<터미널 9> - 최단시간 랩타임 알고리즘 (offline)
cd ~/f1_sim_ws
source install/setup.bash
ros2 run f1tenth_planner offline_planner --ros-args -p map_path:=$(pwd)/src/f1tenth_gym_ros/maps/Spielberg_map.yaml

<터미널 10> - PP 로 최단시간 랩타임 알고리즘 실행
cd ~/f1_sim_ws
source install/setup.bash
ros2 run f1tenth_planner pure_pursuit_node --ros-args -p csv_path:=$(pwd)/raceline_with_speed.csv



<Frenet 지역 경로 실행하기 위해 필요한 최소한의 터미널 구성>

터미널 1
cd ~/f1_sim_ws
source install/setup.bash 
ros2 launch f1tenth_gym_ros gym_bridge_launch.py 

터미널 2 - Frenet 알고리즘
cd ~/f1_sim_ws
source install/setup.bash
ros2 launch racecar_frenet_cpp frenet_local_planner.launch.py 

터미널 3 - 상대차 조작
cd ~/f1_sim_ws
source install/setup.bash
ros2 run racecar_teleop_cpp opp_teleop 

터미널 4 
cd ~/f1_sim_ws
source install/setup.bash
ros2 run racecar_experiments static_path_publisher --ros-args -p csv_path:="$(pwd)/raceline_with_speed.csv"

터미널 5 (이미 CSV 파일이 있다면 실행 안해도 됨)
cd ~/f1_sim_ws
source install/setup.bash 
ros2 run f1tenth_planner offline_planner --ros-args -p map_path:=$(pwd)/src/f1tenth_gym_ros/maps/Spielberg_map.yaml

터미널 6 - 실질적인 시작버튼. 상대차, 자차 주행을 시작함
cd ~/f1_sim_ws
source install/setup.bash
ros2 run f1tenth_planner pure_pursuit_node --ros-args -p use_frenet_path:=true -p frenet_path_topic:=/frenet_local_plan 


# 터미널 1 : 시뮬레이터 브릿지
cd ~/f1_sim_ws
source install/setup.bash 
ros2 launch f1tenth_gym_ros gym_bridge_launch.py 

# 터미널 2 : Frenet 로컬 플래너
#  - MUX가 사용할 첫 번째 경로 (/frenet_local_plan) 생성
cd ~/f1_sim_ws
source install/setup.bash
ros2 launch racecar_frenet_cpp frenet_local_planner.launch.py 


# 터미널 3 : 상대차 조작 노드
cd ~/f1_sim_ws
source install/setup.bash
ros2 run racecar_teleop_cpp opp_teleop 


# 터미널 4 : 전역 경로 CSV 발행
#  - raceline_with_speed.csv 를 /plan 으로 퍼블리시
cd ~/f1_sim_ws
source install/setup.bash
ros2 run racecar_experiments static_path_publisher --ros-args \
  -p csv_path:="$(pwd)/raceline_with_yaw.csv"



# 터미널 5 : 오프라인 플래너 (CSV 없을 때만 1번 실행)
cd ~/f1_sim_ws
source install/setup.bash 
ros2 run f1tenth_planner offline_planner --ros-args \
  -p map_path:=$(pwd)/src/f1tenth_gym_ros/maps/Spielberg_map.yaml

# 터미널 6 : FGM 로컬 플래너
#  - MUX가 사용할 두 번째 경로 (/fgm_path) 생성
cd ~/f1_sim_ws
source install/setup.bash
ros2 run f1tenth_planner fgm_node

# 터미널 7 : MUX 노드
#  - /frenet_local_plan + /fgm_path 를 평가해서 /selected_path 로 출력
cd ~/f1_sim_ws
source install/setup.bash
ros2 run planner_mux planner_mux_node --ros-args \
  -p d_min:=0.45 \
  -p v_ref:=5.0 \
  -p jerk_ref:=5.0 \
  -p track_ref:=0.5 \
  -p w_speed:=1.0 \
  -p w_track:=1.0 \
  -p w_comfort:=1.0 \
  -p max_speed_mux:=6.0 \
  -p max_dv_step_mux:=1.0
차량 최고 속도와 가속도 수동으로 설정 가능

# 터미널 8 : Pure Pursuit (최종 주행)
cd ~/f1_sim_ws
source install/setup.bash
ros2 run f1tenth_planner pure_pursuit_node --ros-args \
  -p use_frenet_path:=true \
  -p frenet_path_topic:=/selected_path
 
<fgm>
ros2 run f1tenth_planner fgm_node --ros-args   -p planning_distance:=3.0   -p gap_threshold:=1.2   -p bubble_radius:=0.45   -p fov_angle:=180.0 -p max_speed:=6.0   -p min_speed:=1.0   -p slow_down_dist:=5.0

